<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List Application</title>

    <meta name="keywords" content="Todo List, Task Manager, To-Do App, HTML, CSS, MySQL, Java EE, JavaScript, API,jquery, Saumya">
    <meta name="description" content="A simple and modern Todo List web application built using HTML, CSS, Java EE, MySQL,jquery and JavaScript by Saumya.">
    <meta name="author" content="Saumya Divyanjalee">
    <!--favicon-->
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">

    <link rel="stylesheet" href="style/index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Atomic+Age&family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Roboto+Slab:wght@100..900&family=Young+Serif&display=swap" rel="stylesheet">
</head>
<body>
<!-- Background Image Layer -->
<div class="app-bg"></div>

<!-- Water Overlay for Bubbles -->
<div class="water">
    <!-- bubbles will appear here -->
</div>

<div class="container">
    <header>
        <h1>MyTodo</h1>
        <p class="subtitle">Turn Goals into Daily Action</p>
    </header>
    <div class="main-card">
        <div class="add-todo-section">
            <h2 style="margin-bottom: 20px;">Add New Todo</h2>
            <form id="todoForm">
                <div class="input-group">
                    <label for="title">Title *</label>
                    <input type="text" id="title" name="title" required placeholder="Enter todo title">
                </div>
                <div class="input-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" placeholder="Enter todo description"></textarea>
                </div>
                <div class="input-group">
                    <label for="priority">Priority</label>
                    <select id="priority" name="priority">
                        <option value="LOW">Low</option>
                        <option value="MEDIUM" selected>Medium</option>
                        <option value="HIGH">High</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Add Todo</button>
            </form>
        </div>
        <div class="filter-section">
            <!--            <strong>Filter:</strong>-->
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="active">Active</button>
            <button class="filter-btn" data-filter="completed">Completed</button>
        </div>
        <div class="todos-section">
            <div class="stats">
                <div class="stat-card total">
                    <div class="stat-number" id="totalCount">0</div>
                    <div class="stat-label">Total Tasks</div>
                </div>
                <div class="stat-card active">
                    <div class="stat-number" id="activeCount">0</div>
                    <div class="stat-label">Active</div>
                </div>
                <div class="stat-card completed">
                    <div class="stat-number" id="completedCount">0</div>
                    <div class="stat-label">Completed</div>
                </div>
            </div>
            <div id="todoList">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading todos...</p>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="js/jquery-3.7.1.min.js"></script>
<script>
    // Backend API URL
    const API_URL = 'http://localhost:8080/Todo_Backend_Web_exploded/api/todos';
    let todos = []; // Array to store all todos
    let currentFilter = 'all'; // Current filter: all, active, completed

    // Run when the document is ready
    $(document).ready(function() {
        loadTodos(); // Load todos from backend
        setupEventListeners(); // Setup form and filter buttons
    });

    // Setup event listeners for form submission and filter buttons
    function setupEventListeners() {
        // Form submit to add new todo
        $('#todoForm').on('submit', function(e) {
            e.preventDefault();
            handleAddTodo();
        });

        // Filter buttons click
        $('.filter-btn').on('click', function() {
            $('.filter-btn').removeClass('active'); // Remove active class from all
            $(this).addClass('active'); // Add active class to clicked button
            currentFilter = $(this).data('filter'); // Update current filter
            renderTodos(); // Re-render todos
        });

        // Delegated event for checkbox toggle
        $('#todoList').on('change', '.todo-checkbox', function() {
            const id = $(this).closest('.todo-item').data('id');
            toggleTodo(id);
        });

        // Delegated event for delete button
        $('#todoList').on('click', '.btn-danger', function() {
            const id = $(this).closest('.todo-item').data('id');
            deleteTodo(id);
        });
    }

    // Load todos from backend
    function loadTodos() {
        $('#todoList').html(`
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading todos...</p>
            </div>
        `);

        $.ajax({
            url: API_URL,
            method: 'GET',
            success: function(data) {
                todos = data; // Store todos
                renderTodos();
            },
            error: function(xhr, status, error) {
                console.error('Error loading todos:', error);
                $('#todoList').html(`
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ùå</div>
                        <h3>Error loading todos</h3>
                        <p>${error}. Check console or ensure backend is running.</p>
                    </div>
                `);
            }
        });
    }

    // Handle adding a new todo
    function handleAddTodo() {
        const todo = {
            title: $('#todoForm [name="title"]').val(),
            description: $('#todoForm [name="description"]').val(),
            priority: $('#todoForm [name="priority"]').val(),
            completed: false
        };

        $.ajax({
            url: API_URL,
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(todo),
            success: function(newTodo) {
                todos.unshift(newTodo); // Add new todo at beginning
                renderTodos();
                $('#todoForm')[0].reset(); // Clear form
            },
            error: function(xhr, status, error) {
                console.error('Error creating todo:', error);
                alert('Failed to create todo: ' + error);
            }
        });
    }

    // Toggle completed status of a todo
    function toggleTodo(id) {
        const todo = todos.find(t => t.id === id);
        if (!todo) return;

        $.ajax({
            url: `${API_URL}/${id}`,
            method: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify({...todo, completed: !todo.completed}),
            success: function(updatedTodo) {
                const index = todos.findIndex(t => t.id === id);
                todos[index] = updatedTodo;
                renderTodos();
            },
            error: function(xhr, status, error) {
                console.error('Error updating todo:', error);
                alert('Failed to update todo: ' + error);
            }
        });
    }

    // Delete a todo
    function deleteTodo(id) {
        if (!confirm('Are you sure you want to delete this todo?')) return;

        $.ajax({
            url: `${API_URL}/${id}`,
            method: 'DELETE',
            success: function() {
                todos = todos.filter(t => t.id !== id);
                renderTodos();
            },
            error: function(xhr, status, error) {
                console.error('Error deleting todo:', error);
                alert('Failed to delete todo: ' + error);
            }
        });
    }

    // Render todos on the page
    function renderTodos() {
        const filteredTodos = todos.filter(todo => {
            if (currentFilter === 'active') return !todo.completed;
            if (currentFilter === 'completed') return todo.completed;
            return true;
        });

        updateStats();

        const todoList = $('#todoList');
        if (filteredTodos.length === 0) {
            todoList.html(`
                <div class="empty-state">
                    <div class="empty-state-icon">üì≠</div>
                    <h3>No todos found</h3>
                    <p>Add a new todo to get started!</p>
                </div>
            `);
            return;
        }

        // Generate HTML for todos
        todoList.html(filteredTodos.map(todo => `
            <div class="todo-item ${todo.completed ? 'completed' : ''} priority-${todo.priority}" data-id="${todo.id}">
                <input type="checkbox" class="todo-checkbox" ${todo.completed ? 'checked' : ''}>
                <div class="todo-content">
                    <div class="todo-title">${escapeHtml(todo.title)}</div>
                    ${todo.description ? `<div class="todo-description">${escapeHtml(todo.description)}</div>` : ''}
                    <div class="todo-meta">
                        <span class="badge badge-priority ${todo.priority}">${todo.priority}</span>
                        <span class="badge">${formatDate(todo.createdAt)}</span>
                    </div>
                </div>
                <div class="todo-actions">
                    <button class="btn btn-danger">Delete</button>
                </div>
            </div>
        `).join(''));
    }

    // Update todo counts
    function updateStats() {
        $('#totalCount').text(todos.length);
        $('#activeCount').text(todos.filter(t => !t.completed).length);
        $('#completedCount').text(todos.filter(t => t.completed).length);
    }

    // Escape HTML to prevent XSS
    function escapeHtml(text) {
        return $('<div>').text(text).html();
    }

    // Format date for display
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    }
</script>


<script>
    const water = document.querySelector('.water');
    function createBubble() {
        const bubble = document.createElement('div');
        bubble.classList.add('bubble');
        const size = Math.random() * 60 + 20;
        bubble.style.width = `${size}px`;
        bubble.style.height = `${size}px`;
        bubble.style.left = `${Math.random() * 100}%`;
        const duration = Math.random() * 8 + 4;
        bubble.style.animationDuration = `${duration}s`;
        water.appendChild(bubble);
        setTimeout(() => {
            bubble.remove();
        }, duration * 1000);
    }
    setInterval(createBubble, 300);
</script>
</body>
</html>